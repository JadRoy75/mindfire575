<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Светлячки — Дневник и Банка</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #0c0c1e 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Звездный фон остается прежним */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; width: 2px; height: 2px; background: #fff; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        .container { position: relative; z-index: 1; max-width: 800px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }

        .screen { display: none; animation: fadeIn 0.5s ease; width: 100%; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Базовые стили инпутов и кнопок */
        input, textarea { width: 100%; padding: 15px; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; background: rgba(255,255,255,0.05); color: #fff; font-size: 16px; margin-bottom: 15px; }
        input:focus, textarea:focus { outline: none; border-color: #ffeb3b; }
        .btn { padding: 15px 30px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(45deg, #ffeb3b, #ff9800); color: #1a1a3e; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(255, 152, 0, 0.5); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }

        /* --- ЭКРАН НАСТРОЕНИЯ С КАСТОМНЫМИ СМАЙЛАМИ --- */
        .mood-container { text-align: center; max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); padding: 40px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.05); }
        .mood-grid { display: flex; justify-content: space-between; gap: 15px; margin-top: 30px; }
        .mood-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: all 0.3s; }
        .mood-item:hover { transform: translateY(-10px); }
        .mood-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; border: 2px solid transparent; transition: all 0.3s; }
        .mood-item.selected .mood-icon { border-color: #fff; box-shadow: 0 0 20px currentColor; }
        .mood-label { font-size: 14px; color: rgba(255,255,255,0.7); font-weight: 500; }
        
        /* Стилизация SVG смайлов */
        .mood-icon svg { width: 35px; height: 35px; stroke-width: 2px; fill: none; }
        .mood-very-bad { color: #ff5252; }
        .mood-bad { color: #ff9800; }
        .mood-normal { color: #ffeb3b; }
        .mood-good { color: #c6ff00; }
        .mood-very-good { color: #00e676; }

        /* --- ГЛАВНЫЙ ЭКРАН (ВЫБОР) --- */
        .choice-container { display: flex; gap: 30px; height: 60vh; position: relative; max-width: 800px; margin: 0 auto; }
        .choice-card { flex: 1; background: rgba(255,255,255,0.02); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .choice-card .icon { color: #fff; margin-bottom: 20px; transition: all 0.3s; }
        .choice-card h2 { font-size: 32px; letter-spacing: 2px; }
        
        /* Эффект свечения с противоположной стороны */
        .choice-light { position: absolute; width: 300px; height: 300px; background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%); border-radius: 50%; pointer-events: none; opacity: 0; transition: opacity 0.5s; }
        .choice-desc { position: absolute; color: rgba(255,255,255,0.8); font-size: 18px; line-height: 1.5; text-align: center; max-width: 200px; opacity: 0; transition: all 0.5s; font-style: italic; }

        /* Логика наведения */
        .choice-card:hover { transform: scale(1.05); background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.3); z-index: 10; }
        .choice-card:hover .icon { transform: scale(1.1); }
        
        #diaryChoice:hover ~ #jarLight { opacity: 1; left: 65%; top: 50%; transform: translate(-50%, -50%); }
        #diaryChoice:hover ~ #jarDesc { opacity: 1; left: 65%; top: 50%; transform: translate(-50%, -50%); }

        #jarChoice:hover ~ #diaryLight { opacity: 1; left: 15%; top: 50%; transform: translate(-50%, -50%); }
        #jarChoice:hover ~ #diaryDesc { opacity: 1; left: 15%; top: 50%; transform: translate(-50%, -50%); }

        /* --- ДНЕВНИК --- */
        .diary-layout { display: grid; grid-template-columns: 250px 1fr; gap: 30px; min-height: 70vh; }
        .diary-nav { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 15px; color: rgba(255,255,255,0.6); border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: 500; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.08); color: #fff; }
        .nav-item i { width: 20px; }

        .diary-content { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 30px; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }

        /* Редактор (Подобие презентации) */
        .rich-editor { min-height: 200px; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 20px; outline: none; border: 1px solid rgba(255,255,255,0.1); font-size: 16px; line-height: 1.6; margin-bottom: 20px; transition: 0.3s; }
        .rich-editor:focus { border-color: #ffeb3b; }
        .editor-tools { display: flex; gap: 10px; margin-bottom: 10px; }
        .tool-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .tool-btn:hover { background: #ffeb3b; color: #000; }
        .rich-editor img { max-width: 100%; border-radius: 8px; margin: 10px 0; }

        /* Карточка записи (для PNG) */
        .entry-card { background: linear-gradient(135deg, #1a1a3e, #2a2a5e); padding: 25px; border-radius: 16px; margin-bottom: 20px; position: relative; overflow: hidden; }
        .entry-header { display: flex; justify-content: space-between; margin-bottom: 15px; color: rgba(255,255,255,0.5); font-size: 14px; }
        .entry-actions { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }

        /* Профиль и Статистика */
        .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .avatar-large { width: 80px; height: 80px; background: linear-gradient(45deg, #ffeb3b, #ff9800); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; color: #000; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; text-align: center; }
        .stat-val { font-size: 32px; font-weight: bold; color: #ffeb3b; margin-bottom: 5px; }

        /* --- БАНКА (Улучшенный визуал) --- */
        .jar-container { position: relative; width: 300px; height: 380px; margin: 30px auto; filter: drop-shadow(0 0 40px rgba(255, 235, 59, 0.15)); }
        .jar-body { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 240px; height: 300px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(8px); border: 2px solid rgba(255, 255, 255, 0.2); border-top: none; border-radius: 30px 30px 80px 80px; overflow: hidden; box-shadow: inset 0 0 50px rgba(255, 255, 255, 0.05); }
        .jar-neck { position: absolute; top: 60px; left: 50%; transform: translateX(-50%); width: 160px; height: 25px; background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(8px); border: 2px solid rgba(255, 255, 255, 0.2); border-bottom: none; border-radius: 12px; }
        .jar-lid { position: absolute; top: 25px; left: 50%; transform: translateX(-50%); width: 180px; height: 45px; background: linear-gradient(135deg, #795548, #5d4037); border-radius: 10px 10px 6px 6px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); z-index: 2; border: 1px solid rgba(255,255,255,0.1); }
        .fireflies-container { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .firefly { position: absolute; width: 12px; height: 12px; border-radius: 50%; animation: float 4s ease-in-out infinite; box-shadow: 0 0 15px currentColor; }
        
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(10px, -15px); } }

        .back-nav { display: flex; align-items: center; gap: 10px; cursor: pointer; color: rgba(255,255,255,0.6); margin-bottom: 20px; font-weight: 500; transition: 0.3s; width: max-content; }
        .back-nav:hover { color: #fff; transform: translateX(-5px); }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <div class="container">
        <div class="screen active" id="authScreen" style="text-align: center; max-width: 400px; margin: auto;">
            <i data-lucide="sparkles" style="width: 64px; height: 64px; color: #ffeb3b; margin-bottom: 20px;"></i>
            <h1 style="font-size: 32px; margin-bottom: 10px;">Светлячки</h1>
            <p style="color: #888; margin-bottom: 30px;">Пространство твоих мыслей и моментов</p>
            <input type="text" id="username" placeholder="Как вас зовут?">
            <input type="password" placeholder="Пароль">
            <button class="btn btn-primary" style="width: 100%;" onclick="showMoodScreen()">Войти в пространство</button>
        </div>

        <div class="screen" id="moodScreen">
            <div class="mood-container">
                <h2 style="font-size: 24px; margin-bottom: 10px;">Как ты себя чувствуешь сегодня?</h2>
                <div class="mood-grid">
                    <div class="mood-item" onclick="selectMood('очень плохо', '#ff5252')">
                        <div class="mood-icon mood-very-bad"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 9h.01M16 9h.01M8 16s1-2 4-2 4 2 4 2"></path></svg></div>
                        <span class="mood-label">Очень плохо</span>
                    </div>
                    <div class="mood-item" onclick="selectMood('плохо', '#ff9800')">
                        <div class="mood-icon mood-bad"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 9h.01M16 9h.01M8 15h8"></path></svg></div>
                        <span class="mood-label">Плохо</span>
                    </div>
                    <div class="mood-item" onclick="selectMood('нормально', '#ffeb3b')">
                        <div class="mood-icon mood-normal"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 9h.01M16 9h.01M9 15s1 1 3 1 3-1 3-1"></path></svg></div>
                        <span class="mood-label">Нормально</span>
                    </div>
                    <div class="mood-item" onclick="selectMood('хорошо', '#c6ff00')">
                        <div class="mood-icon mood-good"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 9h.01M16 9h.01M8 14s1.5 2 4 2 4-2 4-2"></path></svg></div>
                        <span class="mood-label">Хорошо</span>
                    </div>
                    <div class="mood-item" onclick="selectMood('отлично', '#00e676')">
                        <div class="mood-icon mood-very-good"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 9h.01M16 9h.01M8 14s1.5 3 4 3 4-3 4-3"></path></svg></div>
                        <span class="mood-label">Отлично</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="screen" id="mainChoiceScreen">
            <h2 style="text-align: center; margin-bottom: 40px; font-weight: 300;">Куда отправимся, <span id="userNameLabel"></span>?</h2>
            
            <div class="choice-container">
                <div class="choice-light" id="jarLight"></div>
                <div class="choice-desc" id="jarDesc">Здесь живут твои лучшие моменты, как светлячки в темноте.</div>

                <div class="choice-card" id="diaryChoice" onclick="openDiary()">
                    <i data-lucide="book-open" class="icon" style="width: 60px; height: 60px;"></i>
                    <h2>ДНЕВНИК</h2>
                </div>

                <div class="choice-card" id="jarChoice" onclick="openJar()">
                    <i data-lucide="flask-conical" class="icon" style="width: 60px; height: 60px;"></i>
                    <h2>БАНКА</h2>
                </div>

                <div class="choice-light" id="diaryLight"></div>
                <div class="choice-desc" id="diaryDesc">Место для мыслей, рефлексии и исследования себя.</div>
            </div>
        </div>

        <div class="screen" id="jarScreen">
            <div class="back-nav" onclick="showScreen('mainChoiceScreen')">
                <i data-lucide="arrow-left"></i> Вернуться к выбору
            </div>
            
            <div class="jar-container">
                <div class="jar-lid"></div>
                <div class="jar-neck"></div>
                <div class="jar-body">
                    <div class="fireflies-container" id="firefliesContainer"></div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="addFirefly()"><i data-lucide="plus"></i> Положить светлячка</button>
            </div>
        </div>

        <div class="screen" id="diaryScreen">
            <div class="back-nav" onclick="showScreen('mainChoiceScreen')">
                <i data-lucide="arrow-left"></i> Закрыть дневник
            </div>

            <div class="diary-layout">
                <div class="diary-nav">
                    <div class="nav-item active" onclick="switchDiaryTab('create')"><i data-lucide="pen-tool"></i> Создать запись</div>
                    <div class="nav-item" onclick="switchDiaryTab('list')"><i data-lucide="library"></i> Посмотреть записи</div>
                    <div class="nav-item" onclick="switchDiaryTab('achieve')"><i data-lucide="award"></i> Достижения</div>
                    <div class="nav-item" onclick="switchDiaryTab('profile')"><i data-lucide="user"></i> Профиль и Динамика</div>
                </div>

                <div class="diary-content">
                    <div id="tab-create" class="diary-tab active">
                        <h2 style="margin-bottom: 20px;">Новая мысль</h2>
                        <input type="text" id="entryTitle" placeholder="Заголовок (например: Мысли о будущем)">
                        
                        <div class="editor-tools">
                            <button class="tool-btn" onclick="document.execCommand('bold')"><i data-lucide="bold"></i></button>
                            <button class="tool-btn" onclick="document.execCommand('italic')"><i data-lucide="italic"></i></button>
                            <label class="tool-btn" style="cursor: pointer;">
                                <i data-lucide="image"></i>
                                <input type="file" hidden accept="image/*" onchange="insertImage(event)">
                            </label>
                        </div>
                        
                        <div class="rich-editor" id="entryContent" contenteditable="true" placeholder="Пиши здесь... Можно добавлять картинки!"></div>
                        
                        <input type="text" id="entryTags" placeholder="Теги через запятую (работа, семья...)">
                        <button class="btn btn-primary" onclick="saveDiaryEntry()"><i data-lucide="save"></i> Сохранить запись</button>
                    </div>

                    <div id="tab-list" class="diary-tab" style="display: none;">
                        <input type="text" id="searchEntries" placeholder="Поиск по словам или тегам..." oninput="renderEntries()">
                        <div id="entriesList"></div>
                    </div>

                    <div id="tab-achieve" class="diary-tab" style="display: none;">
                        <h2>Ваша активность</h2>
                        <div class="stat-grid" style="margin-top: 20px;">
                            <div class="stat-box">
                                <i data-lucide="feather" style="color: #ffeb3b; margin-bottom: 10px;"></i>
                                <div>Писатель</div>
                                <div style="font-size: 12px; color: #888;">Создано 3 записи</div>
                            </div>
                            <div class="stat-box">
                                <i data-lucide="sparkles" style="color: #4caf50; margin-bottom: 10px;"></i>
                                <div>Исследователь</div>
                                <div style="font-size: 12px; color: #888;">Добавлено 5 светлячков</div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-profile" class="diary-tab" style="display: none;">
                        <div class="profile-header">
                            <div class="avatar-large" id="profileAvatar">П</div>
                            <div>
                                <h2 id="profileName">Пользователь</h2>
                                <p style="color: #888;">В пространстве с 24 Января 2026</p>
                            </div>
                        </div>
                        <h3>Динамика за 30 дней</h3>
                        <div class="stat-grid" style="margin-top: 15px;">
                            <div class="stat-box">
                                <div class="stat-val">80%</div>
                                <div style="color: #888; font-size: 14px;">Хороших дней</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val">12</div>
                                <div style="color: #888; font-size: 14px;">Записей в дневнике</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val">24</div>
                                <div style="color: #888; font-size: 14px;">Светлячка в банке</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация иконок Lucide
        lucide.createIcons();

        // Фон звезд
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 2 + 's';
            starsContainer.appendChild(star);
        }

        let currentUser = null;
        let entries = [];
        let fireflies = [];

        // Навигация
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showMoodScreen() {
            const name = document.getElementById('username').value || 'Путник';
            currentUser = { name };
            document.getElementById('userNameLabel').textContent = name;
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileAvatar').textContent = name.charAt(0).toUpperCase();
            showScreen('moodScreen');
        }

        function selectMood(mood, color) {
            // В реальном приложении сохраняем настроение в БД
            showScreen('mainChoiceScreen');
        }

        // Переходы
        function openDiary() { showScreen('diaryScreen'); }
        function openJar() { showScreen('jarScreen'); renderFireflies(); }

        // Табы Дневника
        function switchDiaryTab(tab) {
            document.querySelectorAll('.diary-nav .nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            document.querySelectorAll('.diary-tab').forEach(el => el.style.display = 'none');
            document.getElementById('tab-' + tab).style.display = 'block';

            if (tab === 'list') renderEntries();
        }

        // Редактор: вставка картинок
        function insertImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.execCommand('insertImage', false, e.target.result);
                }
                reader.readAsDataURL(file);
            }
        }

        // Сохранение записи
        function saveDiaryEntry() {
            const title = document.getElementById('entryTitle').value;
            const content = document.getElementById('entryContent').innerHTML;
            const tags = document.getElementById('entryTags').value.split(',').map(t => t.trim());

            if (!content.trim()) return;

            entries.unshift({
                id: Date.now(),
                title: title || 'Без заголовка',
                content: content,
                tags: tags,
                date: new Date().toLocaleDateString('ru-RU')
            });

            document.getElementById('entryTitle').value = '';
            document.getElementById('entryContent').innerHTML = '';
            document.getElementById('entryTags').value = '';

            alert('Запись сохранена!');
            switchDiaryTab('list');
            document.querySelectorAll('.diary-nav .nav-item')[1].classList.add('active');
            document.querySelectorAll('.diary-nav .nav-item')[0].classList.remove('active');
        }

        // Рендер записей
        function renderEntries() {
            const list = document.getElementById('entriesList');
            const search = document.getElementById('searchEntries').value.toLowerCase();

            const filtered = entries.filter(e => 
                e.title.toLowerCase().includes(search) || 
                e.content.toLowerCase().includes(search) || 
                e.tags.some(t => t.toLowerCase().includes(search))
            );

            list.innerHTML = filtered.map(e => `
                <div class="entry-card" id="entry-${e.id}">
                    <div class="entry-header">
                        <strong>${e.title}</strong>
                        <span>${e.date}</span>
                    </div>
                    <div>${e.content}</div>
                    <div class="entry-actions">
                        ${e.tags.filter(t=>t).map(t => `<span style="background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px; font-size: 12px;">#${t}</span>`).join('')}
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-left: auto;" onclick="shareEntry(${e.id})">
                            <i data-lucide="share-2" style="width: 14px;"></i> Поделиться (PNG)
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // КНОПКА ПОДЕЛИТЬСЯ (ГЕНЕРАЦИЯ PNG)
        function shareEntry(id) {
            const element = document.getElementById(`entry-${id}`);
            
            // Прячем кнопку поделиться перед скриншотом
            const shareBtn = element.querySelector('.btn-secondary');
            shareBtn.style.display = 'none';

            html2canvas(element, {
                backgroundColor: '#1a1a3e',
                scale: 2 // Высокое качество
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `diary_entry_${id}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Возвращаем кнопку обратно
                shareBtn.style.display = 'inline-flex';
            });
        }

        // Логика Банки (Светлячки)
        function addFirefly() {
            fireflies.push({
                x: Math.random() * 80 + 10,
                y: Math.random() * 80 + 10,
                color: ['#ffeb3b', '#4caf50', '#8bc34a'][Math.floor(Math.random() * 3)]
            });
            renderFireflies();
        }

        function renderFireflies() {
            const container = document.getElementById('firefliesContainer');
            container.innerHTML = fireflies.map(f => `
                <div class="firefly" style="
                    left: ${f.x}%; 
                    top: ${f.y}%; 
                    background-color: ${f.color};
                    animation-delay: ${Math.random() * 3}s;
                "></div>
            `).join('');
        }
    </script>
</body>
</html>
